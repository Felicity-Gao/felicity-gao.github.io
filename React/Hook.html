<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hook | Felicity的笔记本</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="旧书不厌百回读，熟读深思子自知">
    <link rel="preload" href="/assets/css/0.styles.ccac5a78.css" as="style"><link rel="preload" href="/assets/js/app.04cf801e.js" as="script"><link rel="preload" href="/assets/js/2.a854afe6.js" as="script"><link rel="preload" href="/assets/js/15.50ad215d.js" as="script"><link rel="prefetch" href="/assets/js/10.f3cbabb8.js"><link rel="prefetch" href="/assets/js/11.8796721f.js"><link rel="prefetch" href="/assets/js/12.2c9e3669.js"><link rel="prefetch" href="/assets/js/13.a548d7c2.js"><link rel="prefetch" href="/assets/js/14.218e1174.js"><link rel="prefetch" href="/assets/js/16.aca784d2.js"><link rel="prefetch" href="/assets/js/17.06643324.js"><link rel="prefetch" href="/assets/js/18.9bd15840.js"><link rel="prefetch" href="/assets/js/19.9dd0fe6c.js"><link rel="prefetch" href="/assets/js/20.8f3d6e79.js"><link rel="prefetch" href="/assets/js/21.cfd1acce.js"><link rel="prefetch" href="/assets/js/22.06b2fd01.js"><link rel="prefetch" href="/assets/js/23.b91608a5.js"><link rel="prefetch" href="/assets/js/24.b8baa705.js"><link rel="prefetch" href="/assets/js/25.6a0f76b3.js"><link rel="prefetch" href="/assets/js/26.93c3674f.js"><link rel="prefetch" href="/assets/js/27.c41d6a07.js"><link rel="prefetch" href="/assets/js/28.67efba8a.js"><link rel="prefetch" href="/assets/js/29.596bf528.js"><link rel="prefetch" href="/assets/js/3.4ad4875a.js"><link rel="prefetch" href="/assets/js/30.11dc1a7f.js"><link rel="prefetch" href="/assets/js/31.a2716ec5.js"><link rel="prefetch" href="/assets/js/32.33cec965.js"><link rel="prefetch" href="/assets/js/33.f52dcc66.js"><link rel="prefetch" href="/assets/js/34.990414af.js"><link rel="prefetch" href="/assets/js/4.1cfc2f80.js"><link rel="prefetch" href="/assets/js/5.34b04f7b.js"><link rel="prefetch" href="/assets/js/6.7c57aeed.js"><link rel="prefetch" href="/assets/js/7.9348dc28.js"><link rel="prefetch" href="/assets/js/8.2eeb1601.js"><link rel="prefetch" href="/assets/js/9.931fa76b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ccac5a78.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/avatar.png" alt="Felicity的笔记本" class="logo"> <span class="site-name can-hide">Felicity的笔记本</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类指引" class="dropdown-title"><span class="title">分类指引</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类指引" class="mobile-dropdown-title"><span class="title">分类指引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Js/" class="nav-link">
  Js
</a></li><li class="dropdown-item"><!----> <a href="/Vue/Vue基础/插槽.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/React/umiJs.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/Vscode/主题及配色.html" class="nav-link">
  Vscode
</a></li><li class="dropdown-item"><!----> <a href="/数据结构与算法/" class="nav-link">
  数据结构与算法
</a></li><li class="dropdown-item"><!----> <a href="/TS/高级类型.html" class="nav-link">
  TS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="延伸拓展" class="dropdown-title"><span class="title">延伸拓展</span> <span class="arrow down"></span></button> <button type="button" aria-label="延伸拓展" class="mobile-dropdown-title"><span class="title">延伸拓展</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/交互设计/" class="nav-link">
  交互设计
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Felicity-Gao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.jianshu.com/u/56e563067653" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书主页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类指引" class="dropdown-title"><span class="title">分类指引</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类指引" class="mobile-dropdown-title"><span class="title">分类指引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Js/" class="nav-link">
  Js
</a></li><li class="dropdown-item"><!----> <a href="/Vue/Vue基础/插槽.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/React/umiJs.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/Vscode/主题及配色.html" class="nav-link">
  Vscode
</a></li><li class="dropdown-item"><!----> <a href="/数据结构与算法/" class="nav-link">
  数据结构与算法
</a></li><li class="dropdown-item"><!----> <a href="/TS/高级类型.html" class="nav-link">
  TS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="延伸拓展" class="dropdown-title"><span class="title">延伸拓展</span> <span class="arrow down"></span></button> <button type="button" aria-label="延伸拓展" class="mobile-dropdown-title"><span class="title">延伸拓展</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/交互设计/" class="nav-link">
  交互设计
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Felicity-Gao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.jianshu.com/u/56e563067653" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书主页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/React/ref.html" class="sidebar-link">Ref</a></li><li><a href="/React/umiJs.html" class="sidebar-link">UmiJS 的一些使用技巧</a></li><li><a href="/React/Hook.html" aria-current="page" class="active sidebar-link">Hook</a></li><li><a href="/React/redux.html" class="sidebar-link">redux</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="hook"><a href="#hook" class="header-anchor">#</a> Hook</h1> <p>Hook 是一些可以让你在函数组件里&quot;钩入&quot;React state 及生命周期等特性的函数。React 内置了一些像<code>useState</code>这样的 Hook。你也可以创建自己的 Hook 来复用不同组件之间的状态逻辑。
<strong>Hook 规则</strong></p> <ol><li><strong>只可以在最顶层使用</strong>（即不要再循环，条件或嵌套函数中使用），不然他们的调用顺序会出现问题。如果想使用循环或判断的话，可以在Hook里面使用。 只可以在最顶层使用</li> <li><strong>只在 React 函数中调用 Hook</strong>，只能在react函数组件及自定义Hook中使用。不能在javascript函数中使用。</li></ol> <p><strong>原因：</strong> 感觉跟函数的参数是一样的，我们写的hook就相当于一个个传入函数中的参数，react在初始时会一一建立对应。但是当你在循环或判断中写上时，当某次运行跳过或多出某个hook时，react还是按原来的个数对应着走，然后就会出现混乱。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">persistForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 👍 将条件判断放置在 effect 中</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'formData'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="state-hook"><a href="#state-hook" class="header-anchor">#</a> State Hook</h2> <p><code>useState</code> 返回一个 <code>state</code>，以及更新 state 的函数<code>setState</code>。我们可以使用结构赋值的方式接收，名字非固定，可以随意填写。<code>initialState</code>是指默认的<code>state</code>的值，非必填，只会在组件的初始渲染中起作用，后续渲染时会被忽略，也<code>可以传入一个函数</code>，在函数中计算并返回初始的 state。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>setState</code>更改 state 时，页面会重新渲染。在<code>setState</code>中可以写一个函数，参数就是上次的<code>state</code>值,可以用对象合并的方式更改本次要修改的值，而不必每次都把所有值写一遍。（因为<code>useState</code>不会自动合并更新对象，如果你在设置里不写的话，就会没有了。这点跟以前的 setState 不一样）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 也可以使用 Object.assign</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>prevState<span class="token punctuation">,</span> <span class="token operator">...</span>updatedValues <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>原地修改 state 并调用 setState <strong>不会</strong>引起重新渲染。</p></div> <h2 id="effect-hook"><a href="#effect-hook" class="header-anchor">#</a> Effect Hook</h2> <p><strong>副作用：</strong> 我们把在组件中执行的数据获取、订阅和手动修改 Dom 等操作统一称之为“副作用”。
<code>useEffect</code>用来替代生命周期钩子函数。</p> <ol><li>当组件重新渲染时会调用<code>useEffect</code>。</li> <li>如果其有返回函数的话，就会在组件卸载的时候执行该返回函数,清除<code>effect</code>。如果组件多次渲染（通常如此），则在执行下一个 <code>effect</code> 之前，上一个 <code>effect</code> 就已被清除。</li> <li>第二个参数是一个数组，可以规定在哪个参数变化时才调用该<code>Effect</code></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">handleStatusChange</span><span class="token punctuation">(</span><span class="token parameter">status</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setIsOnline</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>isOnline<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  ChatAPI<span class="token punctuation">.</span><span class="token function">subscribeToFriendStatus</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>friend<span class="token punctuation">.</span>id<span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ChatAPI<span class="token punctuation">.</span><span class="token function">unsubscribeFromFriendStatus</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>friend<span class="token punctuation">.</span>id<span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">.</span>friend<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 仅在 props.friend.id 发生变化时，重新订阅</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>如果想执行只运行一次的 effect（仅在组件挂载和卸载时执行），可以传递一个空数组（[]）作为第二个参数。</p></blockquote> <h2 id="context-hook"><a href="#context-hook" class="header-anchor">#</a> Context Hook</h2> <p><code>useContext</code> 接收一个<strong>context 对象</strong>(React.createContext 的返回值)并返回该 context 的当前值。当前的 context 值由上层组件中距离当前组件最近的 <code>&lt;MyContext.Provider&gt;</code> 的 value prop 决定。
**注：**必须是contesxt对象，不能传入<code>MyContext.Consumer</code>之类的context的属性。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>MyContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>useContext(MyContext) 相当于 class 组件中的 <code>static contextType = MyContext</code> 或者 <code>&lt;MyContext.Consumer&gt;</code>。</p></blockquote> <p>调用了 useContext 的组件总会在 context 值变化时<strong>重新渲染</strong>。如果重渲染组件的开销较大，你可以 通过使用 memoization 来优化。</p> <h2 id="自定义hook"><a href="#自定义hook" class="header-anchor">#</a> 自定义Hook</h2> <p>自定义Hook是为了把一些需要使用使用到Hook的函数封装为可复用的组件时使用的。（因为Hook规则不允许Hook出现在别的组件中，会导致运行错误）</p> <p>自定义Hook实际上就是一个函数，但它比较特别的是必须使用<strong>use</strong>开头，这样React内部就会自动识别它为Hook，将其置为顶层函数，提前执行。噢，还有这个函数就可以在内部调用其他Hook了。</p> <h2 id="其他hook"><a href="#其他hook" class="header-anchor">#</a> 其他Hook</h2> <h3 id="_1-useref"><a href="#_1-useref" class="header-anchor">#</a> 1. useRef</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> refContainer <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>useRef</code> 返回一个可变的 <code>ref</code> 对象，其 <code>.current</code> 属性被初始化为传入的参数<code>（initialValue）</code>。返回的 ref 对象在组件的整个生命周期内<code>保持不变</code>。</p> <p><code>useRef()</code> 创建的是一个<strong>普通 Javascript 对象</strong>, <code>useRef()</code> 和自建一个 <code>{current: ...}</code> 对象的唯一区别是，<code>useRef</code> 会在每次渲染时返回同一个 <code>ref</code> 对象。</p> <div class="custom-block tip"><p class="custom-block-title">注意</p> <p>因为在Hooks中每次都会重新调用函数，所以是没有常量这个概念的，也可以利用<code>useRef</code>的特性，用他的<code>current</code>来保存常量。保存在<code>current</code>中的值是不会随着hook的调用而改变的，如果你不进行操作的话。</p></div> <h3 id="_2-useimperativehandle"><a href="#_2-useimperativehandle" class="header-anchor">#</a> 2. useImperativeHandle</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> createHandle<span class="token punctuation">,</span> <span class="token punctuation">[</span>deps<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>useImperativeHandle</code> 可以让你在使用 <code>ref</code> 时自定义暴露给父组件的实例值。在大多数情况下，应当避免使用 ref 这样的命令式代码。<code>useImperativeHandle</code> 应当与 <code>forwardRef</code> 一起使用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">FancyInput</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">focus</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span> <span class="token operator">...</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
FancyInput <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span>FancyInput<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 父组件</span>
<span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// ……</span>
  <span class="token keyword">const</span> fInput <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// ....</span>
  fInput<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">//……</span>
  <span class="token operator">&lt;</span>FancyInput ref<span class="token operator">=</span><span class="token punctuation">{</span>fInput<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>在本例中，渲染 <code>&lt;FancyInput ref={inputRef} /&gt;</code> 的父组件<code>finput</code>可以调用 <code>inputRef.current.focus()</code>。</p> <h3 id="_3-usememo"><a href="#_3-usememo" class="header-anchor">#</a> 3. useMemo</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> memoizedValue <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">computeExpensiveValue</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以把第一个参数的函数缓存起来从而达到<code>优化性能</code>的结果。会根据第二个参数的变化情况来调用第一个参数传入函数。只有当第二个参数（deps）的数组中的值发生改变时才会重新调用函数计算结果。如果没有提供第二个参数就会每次都调用了。感觉跟vue的计算属性差不多的功能。</p> <p>我们按照下面这样写的时候，每次点击按钮就会触发<code>Example</code>重新render,其返回的 React Element 也将重新渲染，由于 <code>{main}</code>包含的<code>Element</code>节点也将会重新渲染，如果其render时消耗特别大的话就会造成卡顿。因为在<code>setCount</code>的时候，<code>main</code>并没有变化，所以，实际上我们可以把它缓存起来。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>foo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> main <span class="token operator">=</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> foo<span class="token operator">=</span><span class="token punctuation">{</span>foo<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span> foo<span class="token operator">=</span><span class="token punctuation">{</span>foo<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span> foo<span class="token operator">=</span><span class="token punctuation">{</span>foo<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span> foo<span class="token operator">=</span><span class="token punctuation">{</span>foo<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">}</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">}</span> foo<span class="token operator">=</span><span class="token punctuation">{</span>foo<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>setCount<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token punctuation">{</span>main<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>优化后：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>foo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> main <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> foo<span class="token operator">=</span><span class="token punctuation">{</span>foo<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span> foo<span class="token operator">=</span><span class="token punctuation">{</span>foo<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span> foo<span class="token operator">=</span><span class="token punctuation">{</span>foo<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span> foo<span class="token operator">=</span><span class="token punctuation">{</span>foo<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">}</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">}</span> foo<span class="token operator">=</span><span class="token punctuation">{</span>foo<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>foo<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>setCount<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token punctuation">{</span>main<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>只有当<code>foo</code>变化时<code>main</code>才会重新render, <code>foo</code>不变时就会直接返回上次结果。从而使子组件跳过此次渲染。</p> <div class="custom-block tip"><p class="custom-block-title">注意</p> <p>useMemo 会额外带来空间成本（缓存上一次的结果）了，所以使用时需要衡量，不可滥用。
如：当<code>deps</code>依赖数组为空时，说明你只是希望存储一个值，这个值在重新 render 时永远不会变。这时可以使用<code>useRef</code>替换或者直接第一一个常量。</p></div> <p>还有：useCallback、useReducer、useLayoutEffect、useDebugValue。目前没用到，用到后再补充。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">9/16/2020, 2:29:30 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/React/umiJs.html" class="prev">
        UmiJS 的一些使用技巧
      </a></span> <span class="next"><a href="/React/redux.html">
        redux
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.04cf801e.js" defer></script><script src="/assets/js/2.a854afe6.js" defer></script><script src="/assets/js/15.50ad215d.js" defer></script>
  </body>
</html>
